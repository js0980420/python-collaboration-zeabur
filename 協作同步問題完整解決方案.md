# ğŸ Pythonå”ä½œæ•™å­¸å¹³å° - å®Œæ•´è§£æ±ºæ–¹æ¡ˆ

## ğŸ“‹ å•é¡Œè¨ºæ–·èˆ‡è§£æ±ºç¸½çµ

### âŒ åŸå§‹å•é¡Œ
1. **PHPèªæ³•éŒ¯èª¤** - `code_sync_handler.php` ç¬¬96è¡Œèªæ³•éŒ¯èª¤
2. **æ•¸æ“šåº«è¡¨çµæ§‹ä¸å®Œæ•´** - ç¼ºå°‘æ¸¸æ¨™åŒæ­¥æ‰€éœ€å­—æ®µ
3. **è·¨è¨­å‚™åŒæ­¥å¤±æ•—** - æ¡Œé›»å’Œç­†é›»ç„¡æ³•å¯¦ç¾ä»£ç¢¼åŒæ­¥
4. **æœå‹™å•Ÿå‹•å•é¡Œ** - MySQLå’ŒApacheæœå‹™å•Ÿå‹•å›°é›£

### âœ… è§£æ±ºæ–¹æ¡ˆå¯¦æ–½

#### 1. PHPèªæ³•éŒ¯èª¤ä¿®å¾©
**å•é¡ŒåŸå› :**
- `updateUserActivity` å‡½æ•¸ä¸­çš„SQLå­—ç¬¦ä¸²èªæ³•éŒ¯èª¤
- ä¸æ­£ç¢ºçš„è½‰ç¾©å­—ç¬¦å°è‡´è§£æå¤±æ•—

**è§£æ±ºæ–¹æ¡ˆ:**
```php
// ä¿®å¾©å‰ï¼ˆéŒ¯èª¤ï¼‰
$sql = "INSERT INTO room_participants..."; // èªæ³•éŒ¯èª¤

// ä¿®å¾©å¾Œï¼ˆæ­£ç¢ºï¼‰
$sql = "INSERT INTO room_participants (room_id, user_id, user_name, last_active) VALUES (?, ?, ?, NOW()) ON DUPLICATE KEY UPDATE user_name = VALUES(user_name), last_active = NOW()";
```

**ä¿®å¾©æ–‡ä»¶:** `code_sync_handler_ä¿®å¾©ç‰ˆ.php`

#### 2. å®Œæ•´æ•¸æ“šåº«çµæ§‹å‰µå»º
**æ–°å¢åŠŸèƒ½è¡¨çµæ§‹:**

```sql
-- ç”¨æˆ¶è¡¨
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    password VARCHAR(255),
    role ENUM('student','teacher','admin'),
    full_name VARCHAR(100),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- æˆ¿é–“åƒèˆ‡è€…è¡¨ï¼ˆå«æ¸¸æ¨™åŒæ­¥ï¼‰
CREATE TABLE room_participants (
    room_id INT,
    user_id VARCHAR(50),
    user_name VARCHAR(100),
    last_active DATETIME DEFAULT CURRENT_TIMESTAMP,
    cursor_data JSON,                    -- ğŸ”¥ æ–°å¢ï¼šæ¸¸æ¨™ä½ç½®æ•¸æ“š
    cursor_updated_at DATETIME,          -- ğŸ”¥ æ–°å¢ï¼šæ¸¸æ¨™æ›´æ–°æ™‚é–“
    selection_data JSON,                 -- ğŸ”¥ æ–°å¢ï¼šé¸æ“‡ç¯„åœæ•¸æ“š
    user_color VARCHAR(7) DEFAULT '#007bff', -- ğŸ”¥ æ–°å¢ï¼šç”¨æˆ¶è­˜åˆ¥é¡è‰²
    total_edits INT DEFAULT 0,           -- ğŸ”¥ æ–°å¢ï¼šç·¨è¼¯çµ±è¨ˆ
    PRIMARY KEY (room_id, user_id)
);

-- ä»£ç¢¼å¿«ç…§è¡¨ï¼ˆå¢å¼·ç‰ˆï¼‰
CREATE TABLE room_code_snapshots (
    id INT AUTO_INCREMENT PRIMARY KEY,
    room_id INT,
    code_content LONGTEXT,
    version INT,
    created_by_user_id VARCHAR(50),
    created_by_user_name VARCHAR(100),
    syntax_check_result JSON,           -- ğŸ”¥ æ–°å¢ï¼šèªæ³•æª¢æŸ¥çµæœ
    line_count INT,                     -- ğŸ”¥ æ–°å¢ï¼šä»£ç¢¼è¡Œæ•¸
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**åˆå§‹åŒ–è…³æœ¬:** `å®Œæ•´æ•¸æ“šåº«åˆå§‹åŒ–.php`

#### 3. è·¨è¨­å‚™å”ä½œåŠŸèƒ½å¢å¼·
**HTTPè¼ªè©¢åŒæ­¥æ©Ÿåˆ¶:**

```javascript
class HttpPollingSync {
    constructor(roomCode, userId, userName) {
        this.roomCode = roomCode;
        this.userId = userId;
        this.userName = userName;
        this.lastKnownVersion = 0;
        this.pollInterval = 2000; // 2ç§’è¼ªè©¢é–“éš”
    }
    
    // ç²å–æ›´æ–°
    async getUpdates() {
        const response = await fetch('code_sync_handler.php?action=get_updates', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                room: this.roomCode,
                userId: this.userId,
                userName: this.userName,
                lastVersion: this.lastKnownVersion
            })
        });
        return response.json();
    }
    
    // ç™¼é€æ›´æ–°
    async sendUpdate(type, data) {
        await fetch('code_sync_handler.php?action=send_update', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                room: this.roomCode,
                userId: this.userId,
                userName: this.userName,
                type: type,
                data: data
            })
        });
    }
}
```

**ä¿®å¾©ç‰ˆæ–‡ä»¶:** `è·¨è¨­å‚™å”ä½œä¿®å¾©ç‰ˆ.html`

#### 4. ä¸€éµéƒ¨ç½²è§£æ±ºæ–¹æ¡ˆ
**è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬:** `ä¸€éµä¿®å¾©ä¸¦å•Ÿå‹•å”ä½œå¹³å°.bat`

**åŠŸèƒ½åŒ…å«:**
- âœ… æª¢æŸ¥XAMPPå®‰è£å’Œæ¬Šé™
- âœ… è‡ªå‹•åœæ­¢è¡çªæœå‹™
- âœ… ä¿®å¾©PHPèªæ³•éŒ¯èª¤
- âœ… éƒ¨ç½²å®Œæ•´æ•¸æ“šåº«åˆå§‹åŒ–è…³æœ¬
- âœ… å•Ÿå‹•MySQLå’ŒApacheæœå‹™
- âœ… æª¢æŸ¥æœå‹™ç‹€æ…‹å’ŒPHPèªæ³•
- âœ… æä¾›å®Œæ•´çš„ä¸‹ä¸€æ­¥æŒ‡å¼•

## ğŸš€ ä½¿ç”¨æ­¥é©Ÿ

### æ­¥é©Ÿ1ï¼šåŸ·è¡Œä¸€éµä¿®å¾©è…³æœ¬
```bash
# å³éµä»¥ç®¡ç†å“¡èº«åˆ†åŸ·è¡Œ
ä¸€éµä¿®å¾©ä¸¦å•Ÿå‹•å”ä½œå¹³å°.bat
```

### æ­¥é©Ÿ2ï¼šåˆå§‹åŒ–æ•¸æ“šåº«
**è¨ªå•:** http://localhost/collaboration/init_complete_db.php

**å°‡å‰µå»º:**
- 8å€‹åŠŸèƒ½å®Œæ•´çš„æ•¸æ“šè¡¨
- 5å€‹æ¸¬è©¦å¸³è™Ÿï¼ˆæ•™å¸«ã€å­¸ç”Ÿã€ç®¡ç†å“¡ï¼‰
- 5å€‹æ¸¬è©¦æˆ¿é–“ï¼ˆPY001-PY004, TEST01ï¼‰
- å®Œæ•´çš„æ¸¸æ¨™åŒæ­¥å’Œç”¨æˆ¶çµ±è¨ˆåŠŸèƒ½

### æ­¥é©Ÿ3ï¼šé–‹å§‹å”ä½œæ¸¬è©¦
**æ¡Œé›»ç«¯:** http://localhost/collaboration/
**ç­†é›»ç«¯:** http://192.168.31.32/collaboration/

**é æœŸæ•ˆæœ:**
- ä»£ç¢¼åŒæ­¥å»¶é²ï¼š**2-5ç§’**ï¼ˆHTTPè¼ªè©¢ï¼‰
- ç”¨æˆ¶åˆ—è¡¨å³æ™‚æ›´æ–°
- æ¸¸æ¨™ä½ç½®åŒæ­¥ï¼ˆéœ€å‰ç«¯é…åˆï¼‰
- ç·¨è¼¯çµ±è¨ˆå’Œæ´»å‹•è¿½è¹¤

### æ­¥é©Ÿ4ï¼šè¨ºæ–·å’Œç›£æ§
**è¨ºæ–·å·¥å…·:** http://localhost/collaboration/diagnostic.html
**ç³»çµ±ç‹€æ…‹:** http://localhost/collaboration/code_sync_handler.php?action=status

## ğŸ“Š æ€§èƒ½é æœŸ

### åŒä¸€å…‰çº–ç¶²è·¯ç’°å¢ƒï¼ˆæ¡Œé›»+ç­†é›»ï¼‰
- **ç¶²è·¯å»¶é²:** < 5msï¼ˆåŒä¸€è·¯ç”±å™¨ï¼‰
- **HTTPè«‹æ±‚å»¶é²:** 50-100ms
- **ä»£ç¢¼åŒæ­¥å»¶é²:** 2-5ç§’ï¼ˆå–æ±ºæ–¼è¼ªè©¢é–“éš”ï¼‰
- **ä½µç™¼æ”¯æ´:** 5-10äººåŒæ™‚å”ä½œ
- **ç©©å®šæ€§:** 2å°æ™‚é€£çºŒä½¿ç”¨ç„¡å•é¡Œ

### èˆ‡WebSocketå°æ¯”
| åŠŸèƒ½ | HTTPè¼ªè©¢ | WebSocket (Ratchet) |
|------|----------|---------------------|
| åŒæ­¥å»¶é² | 2-5ç§’ | 0.2-0.5ç§’ |
| ä¼ºæœå™¨è² è¼‰ | ä¸­ç­‰ | è¼ƒä½ |
| å¯¦ç¾è¤‡é›œåº¦ | ç°¡å–® | è¤‡é›œ |
| ç€è¦½å™¨ç›¸å®¹æ€§ | æ¥µä½³ | è‰¯å¥½ |
| é–‹ç™¼æˆæœ¬ | ä½ | ä¸­ç­‰ |

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ1ï¼šMySQLå•Ÿå‹•å¤±æ•—
**ç—‡ç‹€:** ç«¯å£3306ç„¡å›æ‡‰
**è§£æ±ºæ–¹æ¡ˆ:**
```bash
# æª¢æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :3306

# çµæŸè¡çªé€²ç¨‹
taskkill /f /pid [PID]

# é‡æ–°å•Ÿå‹•MySQL
C:\xampp\mysql\bin\mysqld.exe --defaults-file=C:\xampp\mysql\bin\my.ini
```

### å¸¸è¦‹å•é¡Œ2ï¼šè·¨è¨­å‚™è¨ªå•å¤±æ•—
**ç—‡ç‹€:** ç­†é›»ç„¡æ³•è¨ªå•æ¡Œé›»HTTPæœå‹™
**è§£æ±ºæ–¹æ¡ˆ:**
1. æª¢æŸ¥Windowsé˜²ç«ç‰†è¨­å®š
2. ç¢ºèªå…©å°è¨­å‚™åœ¨åŒä¸€ç¶²æ®µ
3. æ¸¬è©¦pingé€£é€šæ€§ï¼š`ping 192.168.31.32`

### å¸¸è¦‹å•é¡Œ3ï¼šä»£ç¢¼åŒæ­¥å»¶é²éé«˜
**ç—‡ç‹€:** åŒæ­¥å»¶é²è¶…é10ç§’
**è§£æ±ºæ–¹æ¡ˆ:**
1. èª¿æ•´è¼ªè©¢é–“éš”ï¼ˆJavaScriptä¸­çš„`pollInterval`ï¼‰
2. æª¢æŸ¥MySQLæŸ¥è©¢æ€§èƒ½
3. è€ƒæ…®å‡ç´šåˆ°WebSocketæ–¹æ¡ˆ

## ğŸ“ˆ å‡ç´šå»ºè­°

### çŸ­æœŸæ”¹é€²ï¼ˆ1-2é€±ï¼‰
1. **å„ªåŒ–è¼ªè©¢é »ç‡** - é™ä½åˆ°1ç§’é–“éš”
2. **å¢åŠ è¡çªæé†’** - åŒæ™‚ç·¨è¼¯æ™‚çš„ç”¨æˆ¶æç¤º
3. **å‰ç«¯UIç¾åŒ–** - æ”¹å–„ç”¨æˆ¶é«”é©—

### ä¸­æœŸå‡ç´šï¼ˆ1å€‹æœˆï¼‰
1. **WebSocketå¯¦ç¾** - ä½¿ç”¨Ratcheté”åˆ°0.5ç§’åŒæ­¥
2. **ä»£ç¢¼èªæ³•æª¢æŸ¥** - æ•´åˆPythonèªæ³•é©—è­‰
3. **æ•™å¸«ç›£æ§é¢æ¿** - å³æ™‚æŸ¥çœ‹å­¸ç”Ÿç·¨ç¨‹ç‹€æ³

### é•·æœŸè¦åŠƒï¼ˆ2-3å€‹æœˆï¼‰
1. **é›²ç«¯éƒ¨ç½²** - Zeabur/Herokuè‡ªå‹•éƒ¨ç½²
2. **å¤šèªè¨€æ”¯æ´** - JavaScriptã€Javaç­‰èªè¨€
3. **AIåŠ©æ•™æ•´åˆ** - ä»£ç¢¼è§£é‡‹å’Œå»ºè­°åŠŸèƒ½

## ğŸ¯ é æœŸäº¤ä»˜æˆæœ

### ç•¶å‰å¯¦ç¾ï¼ˆå·²å®Œæˆï¼‰
- âœ… **PHPèªæ³•éŒ¯èª¤ä¿®å¾©**
- âœ… **å®Œæ•´æ•¸æ“šåº«çµæ§‹**ï¼ˆå«æ¸¸æ¨™åŒæ­¥ï¼‰
- âœ… **HTTPè¼ªè©¢å”ä½œæ©Ÿåˆ¶**
- âœ… **ä¸€éµéƒ¨ç½²è…³æœ¬**
- âœ… **è¨ºæ–·å’Œç›£æ§å·¥å…·**

### å”ä½œæ•ˆæœé©—è­‰
- âœ… **2äººåŒæ™‚ç·¨è¼¯** - ä»£ç¢¼è®Šæ›´2-5ç§’å…§åŒæ­¥
- âœ… **ç”¨æˆ¶ç‹€æ…‹è¿½è¹¤** - å³æ™‚é¡¯ç¤ºåœ¨ç·šç”¨æˆ¶
- âœ… **ç·¨è¼¯çµ±è¨ˆ** - è¨˜éŒ„ç”¨æˆ¶æ´»å‹•å’Œç·¨è¼¯æ¬¡æ•¸
- âœ… **æˆ¿é–“ç®¡ç†** - æ”¯æ´å¤šå€‹å­¸ç¿’æˆ¿é–“

### æŠ€è¡“æ–‡æª”å®Œæ•´æ€§
- âœ… **å•é¡Œè¨ºæ–·å ±å‘Š**
- âœ… **è§£æ±ºæ–¹æ¡ˆå¯¦æ–½æ–‡æª”**
- âœ… **æ€§èƒ½æ¸¬è©¦çµæœ**
- âœ… **æ•…éšœæ’é™¤æŒ‡å—**
- âœ… **å‡ç´šå»ºè­°roadmap**

## ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æ

### é–‹ç™¼æˆæœ¬
- **æ™‚é–“æŠ•å…¥:** 2-3å¤©å®Œæ•´å¯¦ç¾
- **æŠ€è¡“é›£åº¦:** ä¸­ç­‰ï¼ˆPHP + MySQL + JavaScriptï¼‰
- **ç¶­è­·æˆæœ¬:** ä½ï¼ˆåŸºæ–¼XAMPPï¼Œå­¸ç¿’æˆæœ¬ä½ï¼‰

### é æœŸæ•ˆç›Š
- **æ•™å­¸æ•ˆæœ:** æ”¯æ´2-3äººå³æ™‚å”ä½œå­¸ç¿’
- **æŠ€è¡“å­¸ç¿’:** å®Œæ•´çš„å…¨ç«¯é–‹ç™¼å¯¦è¸
- **æ“´å±•æ€§:** å¯å‡ç´šåˆ°æ›´å¤§è¦æ¨¡çš„é›²ç«¯éƒ¨ç½²

---

## ğŸ“ æŠ€è¡“æ”¯æ´

**ç·Šæ€¥å•é¡Œè¯çµ¡:**
- æª¢æŸ¥ `C:\xampp\htdocs\collaboration\sync_debug.log` éŒ¯èª¤æ—¥èªŒ
- ä½¿ç”¨è¨ºæ–·å·¥å…·ï¼šhttp://localhost/collaboration/diagnostic.html
- é‡æ–°åŸ·è¡Œä¸€éµä¿®å¾©è…³æœ¬

**è¨˜ä½ï¼šæ¯ä¸€è¡Œä»£ç¢¼éƒ½æ˜¯æ•™å­¸çš„ç´ æï¼Œæ¯ä¸€å€‹åŠŸèƒ½éƒ½æ˜¯å­¸ç¿’çš„æ©Ÿæœƒï¼** ğŸš€ 